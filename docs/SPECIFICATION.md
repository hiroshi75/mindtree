*   **アプリケーション名:** MindTree (マインドツリー)
*   **概要:** ブラウザ上で動作するマインドマップ作成支援Webアプリケーションです。マインドマップをインデントされた箇条書きツリー形式で表現することで、Webブラウザ上での閲覧・編集を容易にします。ノードの追加・編集・削除はキーボードショートカットにも対応し、直感的な操作性を提供します。
*   **ターゲットユーザー:**
    *   アイデア出しや企画立案を行うビジネスパーソン
    *   学習内容や情報を整理したい学生
    *   思考を整理したいすべての人

**2. 機能一覧**

*   **マインドマップ作成・編集機能:**
    *   **ノードの追加:**
        *   選択中のノードに子ノードを追加 (CTRL + Enter / CTRL + ↓)
        *   選択中のノードの後に兄弟ノードを追加 (Enter / ↓)
    *   **ノードの編集:**
        *   ノードテキストの編集 (テキストクリック)
        *   ノードの選択 (テキスト以外の部分をクリック)
    *   **ノードの削除:**
        *   ノードとその子孫ノードをまとめて削除 (Delete)
        *   マウスオーバー時に表示されるゴミ箱アイコンをクリック
        *   削除前に確認ダイアログを表示
    *   **ノードの移動:**
        *   ドラッグ&ドロップによるノードの移動
    *   **ツリー構造の展開・折りたたみ:**
        *   クリック操作による子ノードの表示・非表示切り替え
    *   **ノードの色付け:**
        *   カラーピッカーによるノード背景色の変更
    *   **LLM連携:**
        *   **LLMによる子ノード生成:**
            *   専用パネル上でプロンプトを入力し、LLMに子ノードの生成を指示

*   **データ保存・読み込み機能:**
    *   **ファイル入出力:**
        *   JSON形式でのマインドマップデータのインポート・エクスポート機能

*   **その他機能:**
    *   **検索機能:**
        *   ノードテキストによるツリー全体の検索
    *   **Undo/Redo機能:**
        *   操作履歴に基づいた元に戻す/やり直す機能

**3. UI/UX**

*   **画面構成:**

    *   **ヘッダー:**
        *   **タイトル:** "MindTree"
        *   **ツールバー:**
            *   **保存:**
                *   アイコン: 
                *   ツールチップ: "マインドマップを保存"
                *   機能: マインドマップデータをJSON形式でエクスポート
            *   **読み込み:**
                *   アイコン: 
                *   ツールチップ: "マインドマップを読み込む"
                *   機能: JSON形式のマインドマップデータをインポート
            *   **Undo:**
                *   アイコン: 
                *   ツールチップ: "元に戻す"
                *   機能: 最後に実行した操作を元に戻す
                *   ショートカットキー: Ctrl + Z
            *   **Redo:**
                *   アイコン: 
                *   ツールチップ: "やり直す"
                *   機能: Undoで元に戻した操作をやり直す
                *   ショートカットキー: Ctrl + Y
        *   **検索バー:**
            *   プレースホルダー: "検索"
            *   機能: 入力されたテキストでノードを検索し、該当するノードをハイライト表示

    *   **メインエリア (左側):**
        *   マインドマップ (インデントされた箇条書きツリー) 表示・編集領域

    *   **専用パネル (右側):**
        *   **タイトル:** "LLM"
        *   **プロンプト入力エリア:**
            *   ラベル: "プロンプト"
            *   テキストエリア: LLMに指示する内容を入力
        *   **詳細設定 (折りたたみ可能):**
            *   ラベル: "詳細設定"
            *   **LLM選択:**
                *   ドロップダウンリスト: 利用するLLMを選択 (例: GPT-3, GPT-4)
            *   **生成数:**
                *   スライダーまたは数値入力: 生成する子ノードの数を指定
            *   **その他のパラメータ:**
                *   必要に応じて、その他のLLMパラメータを設定
        *   **生成ボタン:**
            *   アイコン: 
            *   機能: プロンプトをLLMに送信し、子ノードを生成
        *   **生成されたノードのプレビュー:**
            *   テキストエリア: LLMが生成した子ノードをプレビュー表示
        *   **追加ボタン:**
            *   機能: プレビュー表示された子ノードをマインドマップに追加

*   **UIライブラリ:**
    *   shadcn

*   **操作性:**

    *   **ノードの状態:**
        *   ノードは以下の2つの状態を持つ:
            *   選択状態: ノードが選択されているかどうか
            *   編集状態: ノードが編集可能かどうか

    *   **ノードの選択と編集:**
        *   ノードのテキストをクリックすると:
            *   そのノードが選択状態になる
            *   かつ編集モードに移行
        *   ノードのテキスト以外の部分をクリックすると:
            *   そのノードが選択状態になる
            *   ただし編集モードには移行しない
        *   編集モード中:
            *   ノードテキストが入力可能
            *   Enterキーで編集を確定、Escキーで編集をキャンセル

    *   **ノードの追加:**
        *   選択中のノードに対して:
            *   Enterキーまたは下カーソルキー: 兄弟ノードを追加
            *   CTRL + Enterキーまたは CTRL + 下カーソルキー: 子ノードを追加

    *   **ノードの削除:**
        *   ノードを選択し、Deleteキーを押下
        *   または、ノードを右クリックし、コンテキストメニューから「削除」を選択

    *   **ノードの折りたたみ・展開:**
        *   ノードの左側にある矢印アイコンをクリック
        *   折りたたみ時は右向き矢印 (▶)、展開時は下向き矢印 (▼) を表示

    *   **ドラッグ&ドロップ:**
        *   ノードをドラッグ&ドロップすることで、ノードの位置を移動可能

    *   **ノードの色付け:**
        *   ノードを右クリックし、コンテキストメニューから「色付け」を選択
        *   カラーピッカーが表示され、ノードの背景色を変更可能
        *   または、ノード編集モード中にカラーピッカーを表示し、背景色を変更可能

    *   **LLM連携:**
        *   子ノードを追加したいノードを選択
        *   専用パネルにプロンプトを入力
        *   詳細設定でLLMや生成数などのパラメータを設定 (オプション)
        *   生成ボタンをクリック
        *   プレビュー表示された子ノードを確認
        *   追加ボタンをクリックし、子ノードをマインドマップに追加
        *   LLMの応答はStructured Output方式を採用し、zodスキーマで定義された構造化データとして取得

**4. 技術スタック**

*   **フロントエンド:**
    *   Next.js 15 (App Router)
    *   JavaScript
    *   shadcn

*   **バックエンド:**
    *   Next.js 15 (Server Actions)
    *   SQLite

**8. 仕様書作成履歴**

*   **作成日:** 2024年5月15日
*   **作成者:** Gemini
*   **更新履歴:**
    *   2025年2月1日: ノードの選択状態に関する仕様を追加
    *   2025年2月1日: ノードの削除機能の仕様を更新（ゴミ箱アイコンと確認ダイアログを追加）

**備考:**

*   本仕様書は開発の進捗に合わせて随時更新されます。
*   上記以外にも必要な機能や仕様があれば、適宜追加・修正してください。
